<div class="container-fluid p-4">
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-header bg-primary text-white rounded-top-4">
                    <h2 class="mb-0">Cloud Integration</h2>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="tab-azure" data-bs-toggle="tab" type="button" role="tab" onclick="showForm('azure')">Azure</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tab-aws" data-bs-toggle="tab" type="button" role="tab" onclick="showForm('aws')">AWS</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tab-gcp" data-bs-toggle="tab" type="button" role="tab" onclick="showForm('gcp')">GCP</button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <!-- Azure Form -->
                        <div id="azure-form" class="tab-pane fade show active">
                            <div class="form-floating mb-3">
                                <input type="text" id="azure-subscriptionId" class="form-control" placeholder="Enter Azure Subscription ID">
                                <label>Azure Subscription ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" id="azure-clientId" class="form-control" placeholder="Enter Client ID">
                                <label>Client ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="password" id="azure-clientSecret" class="form-control" placeholder="Enter Client Secret">
                                <label>Client Secret</label>
                            </div>
                            <button class="btn btn-primary w-100" onclick="connectCloud('azure')">Connect to Azure</button>
                        </div>

                        <!-- AWS Form -->
                        <div id="aws-form" class="tab-pane fade">
                            <div class="form-floating mb-3">
                                <input type="text" id="aws-accessKey" class="form-control" placeholder="Enter AWS Access Key">
                                <label>AWS Access Key</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="password" id="aws-secretKey" class="form-control" placeholder="Enter AWS Secret Key">
                                <label>AWS Secret Key</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" id="aws-region" class="form-control" placeholder="Enter AWS Region">
                                <label>Region (e.g., us-east-1)</label>
                            </div>
                            <button class="btn btn-primary w-100" onclick="connectCloud('aws')">Connect to AWS</button>
                        </div>

                        <!-- GCP Form -->
                        <div id="gcp-form" class="tab-pane fade">
                            <div class="form-floating mb-3">
                                <input type="text" id="gcp-projectId" class="form-control" placeholder="Enter GCP Project ID">
                                <label>GCP Project ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <textarea id="gcp-serviceKey" class="form-control" placeholder="Paste GCP Service Account JSON" style="height: 150px;"></textarea>
                                <label>Service Account Key</label>
                            </div>
                            <button class="btn btn-primary w-100" onclick="connectCloud('gcp')">Connect to GCP</button>
                        </div>
                    </div>

                    <!-- Connected Cloud Accounts -->
                    <h3 class="mt-5">Connected Cloud Accounts</h3>
                    <div id="connectedAccounts" class="row gy-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function showForm(provider) {
        document.getElementById("azure-form").style.display = provider === "azure" ? "block" : "none";
        document.getElementById("aws-form").style.display = provider === "aws" ? "block" : "none";
        document.getElementById("gcp-form").style.display = provider === "gcp" ? "block" : "none";

        document.getElementById("tab-azure").classList.remove("active");
        document.getElementById("tab-aws").classList.remove("active");
        document.getElementById("tab-gcp").classList.remove("active");

        document.getElementById(`tab-${provider}`).classList.add("active");
    }

    function connectCloud(provider) {
        let requestBody;

        if (provider === "azure") {
            requestBody = {
                provider,
                subscriptionId: document.getElementById("azure-subscriptionId").value,
                clientId: document.getElementById("azure-clientId").value,
                clientSecret: document.getElementById("azure-clientSecret").value
            };
        } else if (provider === "aws") {
            requestBody = {
                provider,
                accessKey: document.getElementById("aws-accessKey").value,
                secretKey: document.getElementById("aws-secretKey").value,
                region: document.getElementById("aws-region").value
            };
        } else if (provider === "gcp") {
            requestBody = {
                provider,
                projectId: document.getElementById("gcp-projectId").value,
                serviceKey: document.getElementById("gcp-serviceKey").value
            };
        }

        fetch("/api/cloud/connect", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody)
        })
        .then(response => response.json())
        .then(() => {
            alert(`${provider.toUpperCase()} Account Connected!`);
            loadConnectedAccounts();
        })
        .catch(error => console.error("Error connecting:", error));
    }

    function loadConnectedAccounts() {
        fetch("/api/cloud/getConnectedAccounts")
            .then(response => response.json())
            .then(accounts => {
                let accountList = document.getElementById("connectedAccounts");
                accountList.innerHTML = "";
                accounts.forEach(account => {
                    accountList.innerHTML += `
                        <div class="col-lg-4">
                            <div class="card bg-light border rounded-3 shadow-sm">
                                <div class="card-body">
                                    <h5 class="card-title">${account}</h5>
                                    <p class="card-text">Status: <span class="badge bg-success">Connected</span></p>
                                    <button class="btn btn-danger w-100" onclick="disconnectCloud('${account}')">Disconnect</button>
                                </div>
                            </div>
                        </div>`;
                });
            })
            .catch(error => console.error("Error loading accounts:", error));
    }

    function disconnectCloud(subscriptionId) {
        fetch("/api/cloud/disconnect", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ subscriptionId })
        })
        .then(response => response.json())
        .then(() => {
            alert("Cloud account disconnected!");
            loadConnectedAccounts();
        })
        .catch(error => console.error("Error disconnecting:", error));
    }

    document.addEventListener("DOMContentLoaded", loadConnectedAccounts);
</script>
